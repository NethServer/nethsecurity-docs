.. _openvpn_roadwarrior-section:

====================
OpenVPN Road Warrior
====================


Road Warrior refers to a specific configuration of the OpenVPN VPN tailored for remote users, allowing them secure access to a
private network from anywhere on the internet.
This setup is particularly useful for businesses and organizations with employees or collaborators spread across different locations,
ensuring encrypted communication and data privacy.

OpenVPN is a protocol supported by the most widely used platforms, with free clients available for Windows, MacOS, Linux, Android, and iOS systems.

.. note::  Before configuring the OpenVPN Roadwarrior, make sure you have read the chapter related to the :ref:`user database <users_database-section>`.

How it works
------------

An OpenVPN server is running on NethSecurity waiting for remote clients to contact it and establish a connection, it must be reachable from the internet on its specific port (default: 1194 UDP).
Multiple clients can connect to the server, authenticate themselves and gain access to the private network; however, the clients do not need to be reachable on the internet. Each connecting client, after authentication, receives an IP address with which it will present itself to the remote network.

Databases
^^^^^^^^^

An OpenVPN server on NethSecurity is closely tied to a user database, which can be local (already present by default, just needs to be populated with users) or remote to connect to an LDAP or Active Directory server. The association with the database is defined during server creation and cannot be modified later.

On the OpenVPN server, OpenVPN accounts linked to users from the specific database can be created.

Server Configuration
--------------------

The server configuration is straightforward because NethSecurity automatically sets most fields to correct values, which only need verification.

To configure a new OpenVPN server click :guilabel:`Create Server` button and configure/verify the proposed fileds:

``Server name`` : give a name to this OpenVPN server

``User database`` : choose the database where account will be created

``Create an account for each user`` : this is a special field and won't be showed again the future, it allows you to automatically create a VPN account for each user present in the database. All accounts created will have a certificate valid for 3650 days.

``Mode`` : Bridged or routed (default routed)

``Authentication mode`` : several authentication modes are supported:

* Username and password : the connecting client must provide a valid username and password

* Certificate : the connecting client must have its own certificate to authenticate (easiest way)

* Username password and certificate : the connecting client must provide a valid username, password and the related certificate 

* Username OTP and certificate : the connecting client must provide a valid username, certificate and also an OTP code used as a password.This mode require an additional configuration in the client to receive to OTP code

``VPN Network`` : the virtual network used by clients; every client will receive an IP address taken from this network. NethSecurity already suggests an uncommon network to avoid overlaps with other networks used by the firewall.

``Public IP/hostname of this unit`` : NethSecurity automatically fill this field with the public IP address of each configured WAN interface.
These IPs/hostnames will go into the client configuration.
The order of the elements is crucial because the connectiong client will start contacting the IPs/hostnames beginning with the first in the list and then progressing down the list in case of unavailability.

Advanced settings
^^^^^^^^^^^^^^^^^

``Protocol`` : UDP (default) , TCP 

``Port`` : 1194 (default)

``Route all client traffic though VPN`` : if enabled, it routes all traffic generated by the client into the VPN tunnel, even standard internet traffic. It can be used for monitoring and control purposes, but is typically disabled because it introduces increased latency and consumes bandwidth.

``Push network routes`` : the networks that will be routed in the VPN tunnel, the LAN networks are automatically added, but they can also be removed and other networks can be added in the same way

``Allow client-to-client network traffic`` :  allows two clients connected in VPN to exchange traffic; however, it is recommended to leave it disabled.

``Compression`` : It allows compressing the OpenVPN tunnel traffic to save bandwidth. However, it is now a less useful option and, in some cases, can be detrimental. It is recommended to leave it disabled. When this option is modified, it is necessary to download the client configuration again.

``Digest`` : Digest (default SHA 256)

``Cipher`` : Cipher used (default AES-256-GCM) 

``Enforce a minimum TLS version`` : Allows connection only for clients using a TLS version equal to or greater than the one specified.

``Custom DHCP options`` : Allows you to pass specific DHCP options to the client (e.g. DOMAIN, DNS, WINS and so on)

Click on :guilabel:`Create` button to create the server, after that, main server details will be shown in the Web UI.

Client accounts
---------------

Now that the server has been configured, it is necessary to create the accounts for the connecting clients. To do this, click on :guilabel:`Add VPN  Account` and fill the form:

``User`` : each account is associated with one and only user from the chosen database, select the user for this account

``Reserved IP`` : Specify an IP address that is part of the defined VPN network and will always be assigned to this specific account, this can be very useful for creating firewall rules. Leave it blank to assign everytime a random IP address.

``Certificate expiration (days)`` : Specificy a certificate duration (default 3650 days)

Once the account is created, it is necessary to export the configuration and load it into the client that needs to connect. To do this, simply click on the menu of the specific account where these options are located:

``Download configuration`` : Download the ready-to-use file, simply to be loaded into the client. This file is dynamically generated based on the current configuration of the OpenVPN server and already contains all the necessary information, including configuration details (server addresses, port, etc.) and required certificates. In case the server's operating mode is changed (e.g., if the authentication mode is altered), it is necessary to download the file again.

``Download Certificate`` : Download only the necessary certificates; it does not contain any client configuration data.

``Disable`` : Disable the account (it can be re-enabled at any time).

``Regenerate Certificate`` : Recreate the personal certificate for the account; if the current certificate has not expired, it will be revoked, and it will be necessary to use the new one. After recreating the certificate, it is necessary to update it on the client by either redownloading the entire configuration or just the certificate.

``Delete`` : Delete the account and its certificate, this operation is irreversible and the certificate is not recoverable.

Client Behavior
^^^^^^^^^^^^^^^
Some information about the behavior of the clients.

* Clients connected to the Road Warrior are assigned to the ``rwopenvpn`` zone, which is inherently trusted.
  By default this zone has privileged access to both LAN and WAN zones within the network infrastructure.

* Connection Backup: In presence of multiple WANs, clients will connect using the first IP/hostname of the server configuration, if it's unavailable they will use the second IP/hostname and so on if there are many.

* For security reasons, it is not possible to connect multiple clients with the same account. Each account can be used by only one client at a time. 

* If a new client attempts to connect with an account that is already connected to the system, the first account will be disconnected.


Client Software
^^^^^^^^^^^^^^^

All major platforms are supported. Here are some references to download the necessary software:

* Windows Systems: `OpenVPN WebSite <https://openvpn.net/community-downloads/>`_ 

* MacOS Systems :  `TunnelBlick <https://tunnelblick.net/>`_ or the `Official Client <https://openvpn.net/client-connect-vpn-for-mac-os/>

* Linux Systems : Usually already available in your distro's software section, if needed sources are available here : OpenVPN WebSite <https://openvpn.net/community-downloads/>`_ 

* Android Systems : `OpenVPN Connect <https://play.google.com/store/apps/details?id=net.openvpn.openvpn>`_

* iOS Systems : `OpenVPN Connect <https://apps.apple.com/it/app/openvpn-connect-openvpn-app/id590379981>`_







